"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[868],{868:(E,u,l)=>{l.r(u),l.d(u,{HistoryPageModule:()=>P});var p=l(8434),g=l(4341),e=l(3092),h=l(9262),c=l(8244),t=l(1360),y=l(2497);function f(i,a){1&i&&(t.j41(0,"div",4),t.nrm(1,"ion-icon",5),t.j41(2,"p"),t.EFF(3,"No location history available yet."),t.k0s(),t.j41(4,"p"),t.EFF(5,"Turn on location tracking in Settings to start recording your movements."),t.k0s()())}function v(i,a){if(1&i&&(t.j41(0,"ion-row")(1,"ion-col",7)(2,"div",8)(3,"div",9),t.EFF(4,"Start Time"),t.k0s(),t.j41(5,"div",12),t.EFF(6),t.k0s()()(),t.j41(7,"ion-col",7)(8,"div",8)(9,"div",9),t.EFF(10,"End Time"),t.k0s(),t.j41(11,"div",12),t.EFF(12),t.k0s()()()()),2&i){const n=t.XpG(2);t.R7$(6),t.JRh(n.formatTime(n.locationStats.startTime)),t.R7$(6),t.JRh(n.formatTime(n.locationStats.endTime))}}function F(i,a){if(1&i&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&i){const n=t.XpG().$implicit;t.R7$(),t.SpI("Speed: ",t.i5U(2,1,n.speed,"1.1-1")," m/s")}}function b(i,a){if(1&i&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&i){const n=t.XpG().$implicit;t.R7$(),t.SpI("Activity: ",n.activityType,"")}}function H(i,a){if(1&i&&(t.j41(0,"ion-item"),t.nrm(1,"ion-icon",13),t.j41(2,"ion-label")(3,"h2"),t.EFF(4),t.k0s(),t.j41(5,"p"),t.EFF(6),t.nI1(7,"number"),t.nI1(8,"number"),t.k0s(),t.DNE(9,F,3,4,"p",3)(10,b,2,1,"p",3),t.k0s()()),2&i){const n=a.$implicit,o=t.XpG(2);t.R7$(4),t.JRh(o.formatTime(n.timestamp)),t.R7$(2),t.Lme("Lat: ",t.i5U(7,5,n.latitude,"1.6-6"),", Lng: ",t.i5U(8,8,n.longitude,"1.6-6"),""),t.R7$(3),t.Y8G("ngIf",void 0!==n.speed),t.R7$(),t.Y8G("ngIf",n.activityType)}}function S(i,a){if(1&i&&(t.j41(0,"div"),t.nrm(1,"div",6),t.j41(2,"ion-card")(3,"ion-card-header")(4,"ion-card-title"),t.EFF(5,"Trip Summary"),t.k0s()(),t.j41(6,"ion-card-content")(7,"ion-grid")(8,"ion-row")(9,"ion-col",7)(10,"div",8)(11,"div",9),t.EFF(12,"Distance"),t.k0s(),t.j41(13,"div",10),t.EFF(14),t.nI1(15,"number"),t.k0s()()(),t.j41(16,"ion-col",7)(17,"div",8)(18,"div",9),t.EFF(19,"Duration"),t.k0s(),t.j41(20,"div",10),t.EFF(21),t.k0s()()()(),t.DNE(22,v,13,2,"ion-row",3),t.k0s()()(),t.j41(23,"ion-list")(24,"ion-list-header")(25,"ion-label"),t.EFF(26,"Recent Locations"),t.k0s()(),t.DNE(27,H,11,11,"ion-item",11),t.nI1(28,"slice"),t.k0s()()),2&i){const n=t.XpG();t.R7$(14),t.SpI("",t.i5U(15,4,n.locationStats.totalDistance/1e3,"1.2-2")," km"),t.R7$(7),t.JRh(n.formatDuration(n.locationStats.totalTime)),t.R7$(),t.Y8G("ngIf",n.locationStats.startTime&&n.locationStats.endTime),t.R7$(5),t.Y8G("ngForOf",t.brH(28,7,n.locationHistory.slice().reverse(),0,10))}}const T=[{path:"",component:(()=>{var i;class a{constructor(o){this.locationService=o,this.locationHistory=[],this.locationStats={totalDistance:0,totalTime:0},this.historySubscription=null,this.statsSubscription=null,this.map=null,this.mapInitialized=!1}ngOnInit(){this.historySubscription=this.locationService.getLocationHistory().subscribe(o=>{this.locationHistory=o,this.mapInitialized&&o.length>0&&this.updateMap()}),this.statsSubscription=this.locationService.getLocationStats().subscribe(o=>{this.locationStats=o})}ngAfterViewInit(){setTimeout(()=>{this.initMap()},500)}ngOnDestroy(){this.historySubscription&&(this.historySubscription.unsubscribe(),this.historySubscription=null),this.statsSubscription&&(this.statsSubscription.unsubscribe(),this.statsSubscription=null),this.map&&(this.map.remove(),this.map=null)}formatTime(o){return new Date(o).toLocaleString()}formatDuration(o){const s=Math.floor(o/3600),r=Math.floor(o%3600/60);let d="";return s>0&&(d+=`${s}h `),(r>0||s>0)&&(d+=`${r}m `),d+=`${Math.floor(o%60)}s`,d}initMap(){try{console.log("Initializing history map...");const o=document.getElementById("map");if(!o)return void console.error("History map element not found!");console.log("History map element found:",o),this.map&&this.map.remove(),this.map=c.map("map",{center:[0,0],zoom:3,attributionControl:!0}),c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(this.map),this.mapInitialized=!0,setTimeout(()=>{var s;null===(s=this.map)||void 0===s||s.invalidateSize()},100),this.locationHistory.length>0&&this.updateMap()}catch(o){console.error("Error initializing map:",o),this.mapInitialized=!1}}updateMap(){if(!this.map||0===this.locationHistory.length)return;this.map.eachLayer(r=>{var m;r instanceof c.TileLayer||null===(m=this.map)||void 0===m||m.removeLayer(r)});const o=this.locationHistory.map(r=>[r.latitude,r.longitude]),s=c.polyline(o,{color:"#2979FF",weight:3}).addTo(this.map);if(this.locationHistory.length>0){const r=this.locationHistory[0],m=this.locationHistory[this.locationHistory.length-1],d=c.divIcon({className:"custom-div-icon",html:'<div style="background-color:#4CAF50;width:16px;height:16px;border-radius:50%;border:2px solid white;"></div>',iconSize:[16,16],iconAnchor:[8,8]});c.marker([r.latitude,r.longitude],{icon:d,title:"Start"}).addTo(this.map);const k=c.divIcon({className:"custom-div-icon",html:'<div style="background-color:#F44336;width:16px;height:16px;border-radius:50%;border:2px solid white;"></div>',iconSize:[16,16],iconAnchor:[8,8]});c.marker([m.latitude,m.longitude],{icon:k,title:"Current"}).addTo(this.map),this.map.fitBounds(s.getBounds())}}}return(i=a).\u0275fac=function(o){return new(o||i)(t.rXU(y.N))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-history"]],standalone:!1,decls:9,vars:2,consts:[["color","primary"],["slot","start"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-padding","ion-text-center"],["name","map",2,"font-size","64px","color","var(--ion-color-medium)"],["id","map",2,"width","100%","height","50vh"],["size","6"],[1,"stat-container"],[1,"stat-label"],[1,"stat-value"],[4,"ngFor","ngForOf"],[1,"stat-value","small"],["name","location","slot","start","color","primary"]],template:function(o,s){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Location History"),t.k0s()()(),t.j41(6,"ion-content"),t.DNE(7,f,6,0,"div",2)(8,S,29,11,"div",3),t.k0s()),2&o&&(t.R7$(7),t.Y8G("ngIf",!s.locationHistory||0===s.locationHistory.length),t.R7$(),t.Y8G("ngIf",s.locationHistory&&s.locationHistory.length>0))},dependencies:[p.Sq,p.bT,e.QW,e.b_,e.I9,e.ME,e.tN,e.hU,e.W9,e.lO,e.eU,e.iq,e.uz,e.he,e.nf,e.AF,e.MC,e.ln,e.BC,e.ai,p.P9,p.QX],styles:[".stat-container[_ngcontent-%COMP%]{text-align:center;padding:8px}.stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:var(--ion-color-dark)}.stat-value.small[_ngcontent-%COMP%]{font-size:14px}#map[_ngcontent-%COMP%]{height:50vh!important;width:100%!important;z-index:1;border-bottom:1px solid var(--ion-color-light)}"]}),a})()}];let I=(()=>{var i;class a{}return(i=a).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[h.iI.forChild(T),h.iI]}),a})(),P=(()=>{var i;class a{}return(i=a).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[p.MD,g.YN,e.bv,I]}),a})()}}]);